{"version":3,"sources":["update_test.js"],"names":["t","find","allUsers","is","length","name","assertName","createUser","user_1","likes","save","before","after","always","beforeEach","serial","newUser","update","set","findOneAndUpdate","findByIdAndUpdate","_id","$inc","findOne","user"],"mappings":"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","file":"update_test.js","sourcesContent":["import test from 'ava';\nimport mongoose from 'mongoose';\nimport {\n  mongooseConnect,\n  mongooseDisconnect,\n  mongooseDropTestCollection,\n} from '../test_helper';\nimport User from '../../src/user';\n\n\nfunction createUser() {\n  const user_1 = new User({\n    name: 'newUser',\n    likes: 0,\n  });\n  return user_1.save();\n}\n\nasync function assertName(t) {\n  const allUsers = await User.find({});\n  t.is(allUsers.length, 1, 'only one user exists in the database');\n  t.is(allUsers[0].name, 'Alex', 'the user\\'s name is the updated name');\n  return true;\n}\n\ntest.before('connect to database', async (t) => {\n  await mongooseConnect('users_test');\n});\n\ntest.after.always('disconnect from database', async () => {\n  await mongooseDisconnect();\n});\n\ntest.beforeEach('drop test tables', mongooseDropTestCollection);\n\ntest.serial('model instance `update`', async (t) => {\n  const newUser = await createUser();\n  await newUser.update({ name: 'Alex' });\n  await assertName(t);\n});\n\ntest.serial('model instance `set` and `save` ', async (t) => {\n  const newUser = await createUser();\n  newUser.set('name', 'Alex');\n  await newUser.save();\n  await assertName(t);\n});\n\ntest.serial('model class `update` ', async (t) => {\n  const newUser = await createUser();\n  await User.update({ name: 'newUser' }, { name: 'Alex' });\n  await assertName(t);\n});\n\ntest.serial('model class `findOneAndUpdate` ', async (t) => {\n  const newUser = await createUser();\n  await User.findOneAndUpdate({ name: 'newUser' }, { name: 'Alex' });\n  await assertName(t);\n});\n\ntest.serial('model class `findByIdAndUpdate` ', async (t) => {\n  const newUser = await createUser();\n  await User.findByIdAndUpdate(newUser._id, { name: 'Alex' });\n  await assertName(t);\n});\n\ntest.serial('a user can have their postcount incremented by 1 ', async (t) => {\n  const newUser = await createUser();\n  await User.update({ name: 'newUser' }, { $inc: { likes: 10 } });\n  const user = await User.findOne({ name: 'newUser' });\n  t.is( user.likes, 10, 'likes was incremented by ten' );\n});\n\n\n"]}