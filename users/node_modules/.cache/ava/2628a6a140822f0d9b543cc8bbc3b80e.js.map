{"version":3,"sources":["update_test.js"],"names":["t","find","allUsers","is","length","name","assertName","createUser","user_1","save","before","after","always","beforeEach","connection","collections","users","drop","serial","console","log","newUser","update","set","findOneAndUpdate","findByIdAndUpdate","_id"],"mappings":"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","file":"update_test.js","sourcesContent":["import test from 'ava';\nimport mongoose from 'mongoose';\nimport User from '../../src/user';\nimport {\n  mongooseConnect,\n  mongooseDisconnect,\n} from '../test_helper';\n\nfunction createUser() {\n  const user_1 = new User({\n    name: 'newUser',\n  });\n  return user_1.save();\n}\n\nasync function assertName(t) {\n  const allUsers = await User.find({});\n  t.is(allUsers.length, 1, 'only one user exists in the database');\n  t.is(allUsers[0].name, 'Alex', 'the user\\'s name is the updated name');\n  return true;\n}\n\ntest.before('connect to database', async (t) => {\n  await mongooseConnect('users_test');\n});\n\ntest.after.always('disconnect from database', async () => {\n  await mongooseDisconnect();\n});\n\ntest.beforeEach('drop users table', async (t) => {\n  try {\n    await mongoose.connection.collections.users.drop();\n  }\n  catch (err) {\n    // IGNORE EXCEPTION\n  }\n});\n\n\ntest.serial('model instance `update`', async (t) => {\n  console.log('model instance `update`');\n  const newUser = await createUser();\n  await newUser.update({ name: 'Alex' });\n  await assertName(t);\n});\n\ntest.serial('model instance `set` and `save` ', async (t) => {\n  console.log('model instance `set` and `save`');\n  const newUser = await createUser();\n  newUser.set('name', 'Alex');\n  await newUser.save();\n  await assertName(t);\n});\n\ntest.serial('model class `update` ', async (t) => {\n  console.log('model class `update` ');\n  const newUser = await createUser();\n  await User.update({ name: 'newUser' }, { name: 'Alex' });\n  await assertName(t);\n});\n\ntest.serial('model class `findOneAndUpdate` ', async (t) => {\n  console.log('model class `findOneAndUpdate` ');\n  const newUser = await createUser();\n  await User.findOneAndUpdate({ name: 'newUser' }, { name: 'Alex' });\n  await assertName(t);\n});\n\ntest.serial('model class `findByIdAndUpdate` ', async (t) => {\n  console.log('model class `findOneAndUpdate` ');\n  const newUser = await createUser();\n  await User.findByIdAndUpdate(newUser._id, { name: 'Alex' });\n  await assertName(t);\n});\n\n\n"]}